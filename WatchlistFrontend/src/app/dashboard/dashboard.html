<div class="dashboard-container">
  <header>
    <h1>Dashboard</h1>
    <button class="logout-btn" (click)="logout()">Logout</button>
  </header>

  <!-- Filters Section -->
  <div class="filters-panel card">
    <h3>Filters</h3>
    <div class="filter-controls">
      <input type="text" placeholder="Search by title..." [(ngModel)]="filters.search" (keyup.enter)="fetchDashboardData()" />
      <select [(ngModel)]="filters.status">
        <option value="">All Statuses</option>
        <option value="completed">Completed</option>
        <option value="watching">Watching</option>
        <option value="planned">Planned</option>
      </select>
      <select [(ngModel)]="filters.type">
        <option value="">All Types</option>
        <option value="Movie">Movie</option>
        <option value="TV Show">TV Show</option>
      </select>
      <select [(ngModel)]="filters.sortBy">
        <option value="rating">Sort by Rating</option>
        <option value="title">Sort by Title</option>
        <option value="releaseYear">Sort by Year</option>
      </select>
    </div>
    <button (click)="fetchDashboardData()">Apply Filters</button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading">
    <p>Loading dashboard data...</p>
  </div>

  <!-- Main content grid -->
  <div class="dashboard-grid" *ngIf="!isLoading && dashboardData">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="card">
        <h4>Total Items</h4>
        <p>{{ dashboardData.totalItems }}</p>
      </div>
      <div class="card">
        <h4>Completed</h4>
        <p>{{ dashboardData.completedItems }}</p>
      </div>
      <div class="card">
        <h4>Favorites</h4>
        <p>{{ dashboardData.favoriteItems }}</p>
      </div>
      <div class="card">
        <h4>Favorite Genre</h4>
        <p>{{ dashboardData.favoriteGenre || 'N/A' }}</p>
      </div>
    </div>

    <!-- ===== THE CHART CONTAINER HAS BEEN REMOVED FROM HERE ===== -->
    <!-- Top Rated Items Table -->
    <div class="top-rated-container card">
      <h4>Top 5 Rated Items</h4>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Type</th>
            <th>Year</th>
            <th>Rating</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of dashboardData.topRatedItems">
            <td>{{ item.title }}</td>
            <td>{{ item.itemType }}</td>
            <td>{{ item.releaseYear }}</td>
            <td>{{ item.rating.toFixed(1) }}</td>
          </tr>
          <tr *ngIf="dashboardData.topRatedItems.length === 0">
            <td colspan="4">No rated items found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
